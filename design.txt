.. comment: -*- mode:rst;coding:utf-8 -*-

ABNotation Design Notes
################################################################################


Spécifications
================================================================================


Principales fonctionalités

- lecture d'une séquence Midi représentant un morceau de musique.

- affichage de la partition correspondante selon la notation AB en mode prévisualisation.

- impression de la partition (sur feuilles A4 ou A3).

- affichage de la séquence Midi sous forme textuelle comme liste de
  nombres/valeurs : (hauteur duration (h1 h2…) duration …).

- l'utilisateur peut ajuster la mise en page de la partition.

- l'utilisateur peut éditer la partition, en particulier:

    - transposition d'une note ou d'un groupe de notes.


Midi Reader
================================================================================

TODO: see multi-track.

midi track -> sequence of CLUSTER-*note | rest

note-on (channel note velocity≠0)
note-off (channel note velocity), or note-on (channel note velocity=0)
polyphonic-aftertouch (channel note pressure)
program-change (channel program-number)
channel-aftertouch (channel pressure)
pitch-wheel-change (channel value)
control/mode-change


note-on / note-off --> sequence of (cluster-*note | rest)

velocity changes   --> 𝆒   𝆓

velocity intervals -->  𝆏𝆏𝆏 𝆏𝆏 𝆏  𝆐𝆑  𝆐𝆑  𝆑  𝆑𝆑  𝆑𝆑𝆑        𝆒   𝆓
                         1  2  3  4   5  6  7  8      si progression
                                                     linéaire détectée

polyphonic-aftertouch ) --> <>  𝆒   𝆓 ; or ~~~?
channel-aftertouch    )

pitch-wheel-change --> ~~~ or some other?  eg. 𝄳 𝄲 𝄱 𝄰 𝄯 𝄮 𝄭 𝄬 𝄫 






gsharp note pitch is (integer 0 127)

- accidentals (member :natural :flat :double-flat :sharp :double-sharp)

gsharp note durations are defined as:

- head (or null (member :long :breve :whole :half :filled))

- dots (or null (integer 0 3))

Notice: gsharp note is subclass of gsharp-objects, not of
        melodic-element or rhythmic-element.  A note is inside a
        cluster, which is a melodic-element which is a
        rhythmic-element.


 +----------+-------------------+-----------+---------------+---------------------+
 | English  | French            | duration  | rest          | notehead            |
 +==========+===================+===========+===============+=====================+
 |  :maxima |                   | 8         |               |                     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :long   | longue            | 4         | :long-rest    | :breve-notehead     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :breve  | carrée            | 2         | :breve-rest   | :breve-notehead     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :whole  | ronde             | 1         | :whole-rest   | :whole-notehead     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :half   | blanche           | 1/2       | :half-rest    | :half-notehead      |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :filled | noire             | 1/4       | :quarter-rest | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :8th    | croche            | 1/8       | :8th-rest     | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :16th   | double-croche     | 1/16      | :16th-rest    | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :32th   | triple-croche     | 1/32      | :32nd-rest    | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :64th   | quadruple-croche  | 1/64      | :64th-rest    | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :128th  | quintuple-croche  | 1/128     |               |                     |
 +----------+-------------------+-----------+---------------+---------------------+



We should define our own class of notes or cluster (as subclass of
gsharp:cluster).

AB notation notes should be defined as pitch/duration/force.

The duration is defined on the superclass rhythmic-element.
(undotted-duration rhythmic-element)
(duration rhythmic-element)

We can override those methods to have specific durations.


        
Notation AB
================================================================================


Éléments graphiques:

- Numéro de page en haut à gauche dans un cercle (de 1 à N).
- Numéro de système de portées dans la page à gauche de la première portée dans un carré (de 1 à N).
- Numéro de mesure dans la portée au dessus de la marque de début de mesure (de 1 à N).



Impression

- Mise en page en format A4 ou A5, paysage ou portrait.




- option: variation de longueur des mesures pour une même durée de
  référence.



- Réglage longueur mesure: ::

        1      2      3      4      5
        ┌──────┬──────┬──────┬──────┬───────┐

  1. par défaut, minimum selon M = 𝅘𝅥♯𝅘𝅥 (note dieze note) = 6/100 seconde

  2. longeur des mesures:

     a. durée de mesure en x 1/100 seconde (minimum 6/100 seconde) ::

            si < M  alors
               soit mesure(s) affectée(s) rallongées en fonction de M,
               soit toutes les mesures rallongées en fonction de M,
            sinon longueurs identiques

     b. facultatif: réglage de la longueur de toutes les mesures en mm
        (sur page imprimée) ou par ajustement graphiqe d'une mesure
        quelconque, longueur d'une ou de plusieurs mesures
        sélectionneées en mm ou par ajustement graphique.

- Pour tous les réglages d'espace: soit en mm, soit par ajustement
  graphique d'un élément sélectionné (ou ensemble d'éléments)
  affectant l'ensemble, ou l'élément sélectionné.

- Réglage des tailles et polices des chiffres

- Insertion texte et image

- choix du nombre de portées par ligne, avec les clefs: (𝄞 𝄢 𝄞𝄢 𝄟𝄞𝄢 𝄞𝄢𝄤 𝄟𝄞𝄢𝄤)
  (sol fa sol+fa sol8+sol+fa sol+fa+fa8va sol8+sol+fa+fa8va)  ::
 
                                   --sol-5--
                      -------------fa-------------------------
                                  mi        
                      -----------re---------------------------
                                do          
                      ---------si-----------------------------
                              la            
                  sol ---o--sol---------4--------------------- clé de sol 8va
    -------------fa-----------fa------------
                mi    ---------mi-----------------------------
    -----------re---------------re----------
              do                --do--      
    ---------si-----------------------------
            la                              
    ---o--sol--- ------------------------3-- clé de sol
            fa                              
    ---------mi-----------------------------
              re                            
             --do--                         
            si                              
    -------la-------------------------------
          sol                            2  
    ---)-fa--------------------------------- clé de fa
          mi                              
    -------re-------------------------------
            do                            
    ---------si-----------------------------
              la    -------la-------------------------------
    -----------sol--------sol------------1--
                fa  ---)-fa--------------------------------- clé de fa 8vb
                          mi              
                    -------re-------------------------------
                            do            
                    ---------si-----------------------------
                              la          
                    -----------sol-------0------------------
                                fa        
                                --mi--                                          
                                    do   0




- hauteur d'une portée: 3, 5 ou 7 mm (imprimée).

- le début temporel d'une note est dénoté par la bordure gauche de la hampe.

- armature: ♯ pour do et fa, ♭ pour les autres; pas de ♮ bécare.
  Mais option pour: ♭𝅘𝅥♮𝅘𝅥  ou  ♯𝅘𝅥♮𝅘𝅥

- dans le cas de modificateurs préfixes sur la première note d'une
  mesure, ces modificateurs peuvent déborder sur la mesure précédente.
  Si nécessaire, alonger la mesure précédente.


- intensités: symboles avec choix entre continu ou discontinu: ::

        𝆏𝆏𝆏 𝆏𝆏 𝆏  𝆐𝆑  𝆐𝆑  𝆑  𝆑𝆑  𝆑𝆑𝆑        𝆒   𝆓
        1  2  3  4   5  6  7  8      si progression
                                    linéaire détectée

  Quand l'intensité ne change pas, pas de signe.

- polyphonie: notation des agrégats par cluster.

- notation d'une note ou ensemble de notes se prolongeant au delà des
  suivantes.  Première note tenue : ::

        𝅘𝅥  𝅘𝅥   𝅘𝅥
        └ ─ ─ ─ ┘

  toutes les notes tenues : ::

        𝅘𝅥  𝅘𝅥   𝅘𝅥
        └───────┘



.. comment
    (coerce (mapcar 'cdr (remove-if-not (lambda (x) (prefixp "MUSICAL" (car x))) (ucs-names)))
            'string)

      "🎼🎹🎵𝇝𝇜𝇛𝇚𝇙𝇘𝇗𝇖𝇕𝇔𝇓𝇒𝇑𝇐𝇏𝇎𝇍𝇌𝇋𝇊𝇉𝇈𝇇𝇆𝇅𝇄𝇃𝇂𝇁𝆺𝅥𝅯𝆹𝅥𝅯𝆺𝅥𝅮𝆹𝅥𝅮𝆺𝅥𝆹𝅥𝆺𝆹𝆸𝆷𝆶𝆵𝆴𝆳𝆲𝆱𝆰𝆯𝆮𝆭𝆬𝆫𝆪𝆩𝆨𝆧𝆦𝆥𝆤𝆣𝆢𝆡𝆠𝆟𝆞𝆝𝆜𝆛𝆚𝆙𝆘𝆗𝆖𝆕𝆔𝆓𝆒𝆑𝆐𝆏𝆎𝆍𝆌𝆋𝆊𝆉𝆈𝆇𝆆𝆅𝆄𝆃𝆂𝆁𝆀𝅿𝅾𝅽𝅼𝅻𝅺𝅹𝅸𝅷𝅶𝅵𝅴𝅳𝅲𝅱𝅰𝅯𝅮𝅭𝅬𝅫𝅪𝅩𝅨𝅧𝅦𝅥𝅘𝅥𝅲𝅘𝅥𝅱𝅘𝅥𝅰𝅘𝅥𝅯𝅘𝅥𝅮𝅘𝅥𝅗𝅥𝅝𝅜𝅛𝅚𝅙𝅘𝅗𝅖𝅕𝅔𝅓𝅒𝅑𝅐𝅏𝅎𝅍𝅌𝅋𝅊𝅉𝅈𝅇𝅆𝅅𝅄𝅃𝅂𝅁𝅀𝄿𝄾𝄽𝄼𝄻𝄺𝄹𝄸𝄷𝄶𝄵𝄴𝄳𝄲𝄱𝄰𝄯𝄮𝄭𝄬𝄫𝄪𝄩𝄦𝄥𝄤𝄣𝄢𝄡𝄠𝄟𝄞𝄝𝄜𝄛𝄚𝄙𝄘𝄗𝄖𝄕𝄔𝄓𝄒𝄑𝄐𝄏𝄎𝄍𝄌𝄋𝄊𝄉𝄈𝄇𝄆𝄅𝄄𝄃𝄂𝄁𝄀"



Gsharp Schematic class diagram
================================================================================

::


                                                                       key-signature
                                                                            |
                                    +-----------------------------1 clef    |         time-signature
                                    |                                |      |               |
                                    |                                +------+---------------+
                                    |                                       |
                                    |                                       v
                         fiveline-staff 1--------------------------* staffwise-element
                               |                                            |
                               v                                            |
       +-------------------* staff                                          |
       |                       *                                            |
       |                       |                                            v
    buffer 1--* segment 1--* layer 1--3 slice 1--* bar 1---------------* element
                               |                    |                      ^
                               |                    |                      |
                               |                    |               rhythmic-element
                               |                    |                      ^
                               |                    |                      |
                          melody-layer         melody-bar             melody-element
                                                                           ^
                                                                           |
                                                                           +-----------+
                                                                           |           |
                                                                        cluster       rest
                                                                           |
                                                                           *
                                                                          note
                                                                              
                                                                              
              tuning                                                          
                ^                                                             
                |                                                             
                +---------+                                                   
                |         |                                                   
              12-edo   regular-temperament                                    
                                                                              


.. comment:
   ---------------------------------------------------------------
                            -------------
                                  -
                                  .
