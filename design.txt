.. comment: -*- mode:rst;coding:utf-8 -*-

ABNotation Design Notes
################################################################################


SpÃ©cifications
================================================================================


Principales fonctionalitÃ©s

- lecture d'une sÃ©quence Midi reprÃ©sentant un morceau de musique.

- affichage de la partition correspondante selon la notation AB en mode prÃ©visualisation.

- impression de la partition (sur feuilles A4 ou A3).

- affichage de la sÃ©quence Midi sous forme textuelle comme liste de
  nombres/valeurs : (hauteur duration (h1 h2â€¦) duration â€¦).

- l'utilisateur peut ajuster la mise en page de la partition.

- l'utilisateur peut Ã©diter la partition, en particulier:

    - transposition d'une note ou d'un groupe de notes.


Midi Reader
================================================================================

TODO: see multi-track.

midi track -> sequence of CLUSTER-*note | rest

note-on (channel note velocityâ‰ 0)
note-off (channel note velocity), or note-on (channel note velocity=0)
polyphonic-aftertouch (channel note pressure)
program-change (channel program-number)
channel-aftertouch (channel pressure)
pitch-wheel-change (channel value)
control/mode-change


note-on / note-off --> sequence of (cluster-*note | rest)

velocity changes   --> ğ†’   ğ†“

velocity intervals -->  ğ†ğ†ğ† ğ†ğ† ğ†  ğ†ğ†‘  ğ†ğ†‘  ğ†‘  ğ†‘ğ†‘  ğ†‘ğ†‘ğ†‘        ğ†’   ğ†“
                         1  2  3  4   5  6  7  8      si progression
                                                     linÃ©aire dÃ©tectÃ©e

polyphonic-aftertouch ) --> <>  ğ†’   ğ†“ ; or ~~~?
channel-aftertouch    )

pitch-wheel-change --> ~~~ or some other?  eg. ğ„³ ğ„² ğ„± ğ„° ğ„¯ ğ„® ğ„­ ğ„¬ ğ„« 






gsharp note pitch is (integer 0 127)

- accidentals (member :natural :flat :double-flat :sharp :double-sharp)

gsharp note durations are defined as:

- head (or null (member :long :breve :whole :half :filled))

- dots (or null (integer 0 3))

Notice: gsharp note is subclass of gsharp-objects, not of
        melodic-element or rhythmic-element.  A note is inside a
        cluster, which is a melodic-element which is a
        rhythmic-element.


 +----------+-------------------+-----------+---------------+---------------------+
 | English  | French            | duration  | rest          | notehead            |
 +==========+===================+===========+===============+=====================+
 |  :maxima |                   | 8         |               |                     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :long   | longue            | 4         | :long-rest    | :breve-notehead     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :breve  | carrÃ©e            | 2         | :breve-rest   | :breve-notehead     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :whole  | ronde             | 1         | :whole-rest   | :whole-notehead     |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :half   | blanche           | 1/2       | :half-rest    | :half-notehead      |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :filled | noire             | 1/4       | :quarter-rest | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :8th    | croche            | 1/8       | :8th-rest     | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :16th   | double-croche     | 1/16      | :16th-rest    | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :32th   | triple-croche     | 1/32      | :32nd-rest    | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :64th   | quadruple-croche  | 1/64      | :64th-rest    | :filled-notehead    |
 +----------+-------------------+-----------+---------------+---------------------+
 |  :128th  | quintuple-croche  | 1/128     |               |                     |
 +----------+-------------------+-----------+---------------+---------------------+



We should define our own class of notes or cluster (as subclass of
gsharp:cluster).

AB notation notes should be defined as pitch/duration/force.

The duration is defined on the superclass rhythmic-element.
(undotted-duration rhythmic-element)
(duration rhythmic-element)

We can override those methods to have specific durations.


        
Notation AB
================================================================================


Ã‰lÃ©ments graphiques:

- NumÃ©ro de page en haut Ã  gauche dans un cercle (de 1 Ã  N).
- NumÃ©ro de systÃ¨me de portÃ©es dans la page Ã  gauche de la premiÃ¨re portÃ©e dans un carrÃ© (de 1 Ã  N).
- NumÃ©ro de mesure dans la portÃ©e au dessus de la marque de dÃ©but de mesure (de 1 Ã  N).



Impression

- Mise en page en format A4 ou A5, paysage ou portrait.




- option: variation de longueur des mesures pour une mÃªme durÃ©e de
  rÃ©fÃ©rence.



- RÃ©glage longueur mesure: ::

        1      2      3      4      5
        â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”

  1. par dÃ©faut, minimum selon M = ğ…Ÿâ™¯ğ…Ÿ (note dieze note) = 6/100 seconde

  2. longeur des mesures:

     a. durÃ©e de mesure en x 1/100 seconde (minimum 6/100 seconde) ::

            si < M  alors
               soit mesure(s) affectÃ©e(s) rallongÃ©es en fonction de M,
               soit toutes les mesures rallongÃ©es en fonction de M,
            sinon longueurs identiques

     b. facultatif: rÃ©glage de la longueur de toutes les mesures en mm
        (sur page imprimÃ©e) ou par ajustement graphiqe d'une mesure
        quelconque, longueur d'une ou de plusieurs mesures
        sÃ©lectionneÃ©es en mm ou par ajustement graphique.

- Pour tous les rÃ©glages d'espace: soit en mm, soit par ajustement
  graphique d'un Ã©lÃ©ment sÃ©lectionnÃ© (ou ensemble d'Ã©lÃ©ments)
  affectant l'ensemble, ou l'Ã©lÃ©ment sÃ©lectionnÃ©.

- RÃ©glage des tailles et polices des chiffres

- Insertion texte et image

- choix du nombre de portÃ©es par ligne, avec les clefs: (ğ„ ğ„¢ ğ„ğ„¢ ğ„Ÿğ„ğ„¢ ğ„ğ„¢ğ„¤ ğ„Ÿğ„ğ„¢ğ„¤)
  (sol fa sol+fa sol8+sol+fa sol+fa+fa8va sol8+sol+fa+fa8va)  ::
 
                                   --sol-5--
                      -------------fa-------------------------
                                  mi        
                      -----------re---------------------------
                                do          
                      ---------si-----------------------------
                              la            
                  sol ---o--sol---------4--------------------- clÃ© de sol 8va
    -------------fa-----------fa------------
                mi    ---------mi-----------------------------
    -----------re---------------re----------
              do                --do--      
    ---------si-----------------------------
            la                              
    ---o--sol--- ------------------------3-- clÃ© de sol
            fa                              
    ---------mi-----------------------------
              re                            
             --do--                         
            si                              
    -------la-------------------------------
          sol                            2  
    ---)-fa--------------------------------- clÃ© de fa
          mi                              
    -------re-------------------------------
            do                            
    ---------si-----------------------------
              la    -------la-------------------------------
    -----------sol--------sol------------1--
                fa  ---)-fa--------------------------------- clÃ© de fa 8vb
                          mi              
                    -------re-------------------------------
                            do            
                    ---------si-----------------------------
                              la          
                    -----------sol-------0------------------
                                fa        
                                --mi--                                          
                                    do   0




- hauteur d'une portÃ©e: 3, 5 ou 7 mm (imprimÃ©e).

- le dÃ©but temporel d'une note est dÃ©notÃ© par la bordure gauche de la hampe.

- armature: â™¯ pour do et fa, â™­ pour les autres; pas de â™® bÃ©care.
  Mais option pour: â™­ğ…Ÿâ™®ğ…Ÿ  ou  â™¯ğ…Ÿâ™®ğ…Ÿ

- dans le cas de modificateurs prÃ©fixes sur la premiÃ¨re note d'une
  mesure, ces modificateurs peuvent dÃ©border sur la mesure prÃ©cÃ©dente.
  Si nÃ©cessaire, alonger la mesure prÃ©cÃ©dente.


- intensitÃ©s: symboles avec choix entre continu ou discontinu: ::

        ğ†ğ†ğ† ğ†ğ† ğ†  ğ†ğ†‘  ğ†ğ†‘  ğ†‘  ğ†‘ğ†‘  ğ†‘ğ†‘ğ†‘        ğ†’   ğ†“
        1  2  3  4   5  6  7  8      si progression
                                    linÃ©aire dÃ©tectÃ©e

  Quand l'intensitÃ© ne change pas, pas de signe.

- polyphonie: notation des agrÃ©gats par cluster.

- notation d'une note ou ensemble de notes se prolongeant au delÃ  des
  suivantes.  PremiÃ¨re note tenue : ::

        ğ…Ÿ  ğ…Ÿ   ğ…Ÿ
        â”” â”€ â”€ â”€ â”˜

  toutes les notes tenues : ::

        ğ…Ÿ  ğ…Ÿ   ğ…Ÿ
        â””â”€â”€â”€â”€â”€â”€â”€â”˜



.. comment
    (coerce (mapcar 'cdr (remove-if-not (lambda (x) (prefixp "MUSICAL" (car x))) (ucs-names)))
            'string)

      "ğŸ¼ğŸ¹ğŸµğ‡ğ‡œğ‡›ğ‡šğ‡™ğ‡˜ğ‡—ğ‡–ğ‡•ğ‡”ğ‡“ğ‡’ğ‡‘ğ‡ğ‡ğ‡ğ‡ğ‡Œğ‡‹ğ‡Šğ‡‰ğ‡ˆğ‡‡ğ‡†ğ‡…ğ‡„ğ‡ƒğ‡‚ğ‡ğ‡€ğ†¿ğ†¾ğ†½ğ†¼ğ†»ğ†ºğ†¹ğ†¸ğ†·ğ†¶ğ†µğ†´ğ†³ğ†²ğ†±ğ†°ğ†¯ğ†®ğ†­ğ†¬ğ†«ğ†ªğ†©ğ†¨ğ†§ğ†¦ğ†¥ğ†¤ğ†£ğ†¢ğ†¡ğ† ğ†Ÿğ†ğ†ğ†œğ†›ğ†šğ†™ğ†˜ğ†—ğ†–ğ†•ğ†”ğ†“ğ†’ğ†‘ğ†ğ†ğ†ğ†ğ†Œğ†‹ğ†Šğ†‰ğ†ˆğ†‡ğ††ğ†…ğ†„ğ†ƒğ†‚ğ†ğ†€ğ…¿ğ…¾ğ…½ğ…¼ğ…»ğ…ºğ…¹ğ…¸ğ…·ğ…¶ğ…µğ…´ğ…³ğ…²ğ…±ğ…°ğ…¯ğ…®ğ…­ğ…¬ğ…«ğ…ªğ…©ğ…¨ğ…§ğ…¦ğ…¥ğ…¤ğ…£ğ…¢ğ…¡ğ… ğ…Ÿğ…ğ…ğ…œğ…›ğ…šğ…™ğ…˜ğ…—ğ…–ğ…•ğ…”ğ…“ğ…’ğ…‘ğ…ğ…ğ…ğ…ğ…Œğ…‹ğ…Šğ…‰ğ…ˆğ…‡ğ…†ğ……ğ…„ğ…ƒğ…‚ğ…ğ…€ğ„¿ğ„¾ğ„½ğ„¼ğ„»ğ„ºğ„¹ğ„¸ğ„·ğ„¶ğ„µğ„´ğ„³ğ„²ğ„±ğ„°ğ„¯ğ„®ğ„­ğ„¬ğ„«ğ„ªğ„©ğ„¦ğ„¥ğ„¤ğ„£ğ„¢ğ„¡ğ„ ğ„Ÿğ„ğ„ğ„œğ„›ğ„šğ„™ğ„˜ğ„—ğ„–ğ„•ğ„”ğ„“ğ„’ğ„‘ğ„ğ„ğ„ğ„ğ„Œğ„‹ğ„Šğ„‰ğ„ˆğ„‡ğ„†ğ„…ğ„„ğ„ƒğ„‚ğ„ğ„€"



Gsharp Schematic class diagram
================================================================================

::


                                                                       key-signature
                                                                            |
                                    +-----------------------------1 clef    |         time-signature
                                    |                                |      |               |
                                    |                                +------+---------------+
                                    |                                       |
                                    |                                       v
                         fiveline-staff 1--------------------------* staffwise-element
                               |                                            |
                               v                                            |
       +-------------------* staff                                          |
       |                       *                                            |
       |                       |                                            v
    buffer 1--* segment 1--* layer 1--3 slice 1--* bar 1---------------* element
                               |                    |                      ^
                               |                    |                      |
                               |                    |               rhythmic-element
                               |                    |                      ^
                               |                    |                      |
                          melody-layer         melody-bar             melody-element
                                                                           ^
                                                                           |
                                                                           +-----------+
                                                                           |           |
                                                                        cluster       rest
                                                                           |
                                                                           *
                                                                          note
                                                                              
                                                                              
              tuning                                                          
                ^                                                             
                |                                                             
                +---------+                                                   
                |         |                                                   
              12-edo   regular-temperament                                    
                                                                              


.. comment:
   ---------------------------------------------------------------
                            -------------
                                  -
                                  .
