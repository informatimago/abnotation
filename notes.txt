.. comment: -*- mode:rst;coding:utf-8 -*

(setf (getenv "NSZombieEnabled") "YES")
(setf (getenv "NSDeallocateZombies") "YES")

https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECENABLE

Abnotation
################################################################################


Sp√©cifications
================================================================================


Principales fonctionalit√©s

- lecture d'une s√©quence Midi repr√©sentant un morceau de musique.

- affichage de la partition correspondante selon la notation AB en mode pr√©visualisation.

- impression de la partition (sur feuilles A4 ou A3).

- affichage de la s√©quence Midi sous forme textuelle comme liste de
  nombres/valeurs : (hauteur duration (h1 h2‚Ä¶) duration ‚Ä¶).

- l'utilisateur peut ajuster la mise en page de la partition.

- l'utilisateur peut √©diter la partition, en particulier:

    - transposition d'une note ou d'un groupe de notes.



Notation AB
================================================================================


√âl√©ments graphiques:

- Num√©ro de page en haut √† gauche dans un cercle (de 1 √† N).
- Num√©ro de syst√®me de port√©es dans la page √† gauche de la premi√®re port√©e dans un carr√© (de 1 √† N).
- Num√©ro de mesure dans la port√©e au dessus de la marque de d√©but de mesure (de 1 √† N).



Impression

- Mise en page en format A4 ou A5, paysage ou portrait.




- option: variation de longueur des mesures pour une m√™me dur√©e de
  r√©f√©rence.



- R√©glage longueur mesure: ::

        1      2      3      4      5
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê

  1. par d√©faut, minimum selon M = ùÖü‚ôØùÖü (note dieze note) = 6/100 seconde

  2. longueur des mesures:

     a. dur√©e de mesure en x 1/100 seconde (minimum 6/100 seconde) ::

            si < M  alors
               soit mesure(s) affect√©e(s) rallong√©es en fonction de M,
               soit toutes les mesures rallong√©es en fonction de M,
            sinon longueurs identiques

     b. facultatif: r√©glage de la longueur de toutes les mesures en mm
        (sur page imprim√©e) ou par ajustement graphiqe d'une mesure
        quelconque, longueur d'une ou de plusieurs mesures
        s√©lectionne√©es en mm ou par ajustement graphique.

- Pour tous les r√©glages d'espace: soit en mm, soit par ajustement
  graphique d'un √©l√©ment s√©lectionn√© (ou ensemble d'√©l√©ments)
  affectant l'ensemble, ou l'√©l√©ment s√©lectionn√©.

- R√©glage des tailles et polices des chiffres

- Insertion texte et image

- choix du nombre de port√©es par ligne, avec les clefs: (ùÑû ùÑ¢ ùÑûùÑ¢ ùÑûùÑ∏ùÑûùÑ¢ ùÑûùÑ¢ùÑ¢ùÑπ ùÑûùÑ∏ùÑûùÑ¢ùÑ¢ùÑπ)
  (sol fa sol+fa sol15ma+sol+fa sol+fa+fa15mb sol15ma+sol+fa+fa15mb)  ::
  La note la plus basse est do1.

- hauteur d'une port√©e: 3, 5 ou 7 mm (imprim√©e).

- le d√©but temporel d'une note est d√©not√© par la bordure gauche de la hampe.

- armature: ‚ôØ pour do et fa, ‚ô≠ pour les autres; pas de ‚ôÆ b√©care.
  Mais option pour: ‚ô≠ùÖü‚ôÆùÖü  ou  ‚ôØùÖü‚ôÆùÖü

- dans le cas de modificateurs pr√©fixes sur la premi√®re note d'une
  mesure, ces modificateurs peuvent d√©border sur la mesure pr√©c√©dente.
  Si n√©cessaire, alonger la mesure pr√©c√©dente.


- intensit√©s: symboles avec choix entre continu ou discontinu: ::

        ùÜèùÜèùÜè ùÜèùÜè ùÜè  ùÜêùÜë  ùÜêùÜë  ùÜë  ùÜëùÜë  ùÜëùÜëùÜë        ùÜí   ùÜì
        1  2  3  4   5  6  7  8      si progression
                                    lin√©aire d√©tect√©e

  Quand l'intensit√© ne change pas, pas de signe.

- polyphonie: notation des agr√©gats par cluster.

- notation d'une note ou ensemble de notes se prolongeant au del√† des
  suivantes.  Premi√®re note tenue : ::

        ùÖü  ùÖü   ùÖü
        ‚îî ‚îÄ ‚îÄ ‚îÄ ‚îò

  toutes les notes tenues : ::

        ùÖü  ùÖü   ùÖü
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò



.. comment
    (coerce (mapcar 'cdr (remove-if-not (lambda (x) (prefixp "MUSICAL" (car x))) (ucs-names)))
            'string)

      "üéºüéπüéµùáùùáúùáõùáöùáôùáòùáóùáñùáïùáîùáìùáíùáëùáêùáèùáéùáçùáåùáãùáäùáâùáàùááùáÜùáÖùáÑùáÉùáÇùáÅùáÄùÜøùÜæùÜΩùÜºùÜªùÜ∫ùÜπùÜ∏ùÜ∑ùÜ∂ùÜµùÜ¥ùÜ≥ùÜ≤ùÜ±ùÜ∞ùÜØùÜÆùÜ≠ùÜ¨ùÜ´ùÜ™ùÜ©ùÜ®ùÜßùÜ¶ùÜ•ùÜ§ùÜ£ùÜ¢ùÜ°ùÜ†ùÜüùÜûùÜùùÜúùÜõùÜöùÜôùÜòùÜóùÜñùÜïùÜîùÜìùÜíùÜëùÜêùÜèùÜéùÜçùÜåùÜãùÜäùÜâùÜàùÜáùÜÜùÜÖùÜÑùÜÉùÜÇùÜÅùÜÄùÖøùÖæùÖΩùÖºùÖªùÖ∫ùÖπùÖ∏ùÖ∑ùÖ∂ùÖµùÖ¥ùÖ≥ùÖ≤ùÖ±ùÖ∞ùÖØùÖÆùÖ≠ùÖ¨ùÖ´ùÖ™ùÖ©ùÖ®ùÖßùÖ¶ùÖ•ùÖ§ùÖ£ùÖ¢ùÖ°ùÖ†ùÖüùÖûùÖùùÖúùÖõùÖöùÖôùÖòùÖóùÖñùÖïùÖîùÖìùÖíùÖëùÖêùÖèùÖéùÖçùÖåùÖãùÖäùÖâùÖàùÖáùÖÜùÖÖùÖÑùÖÉùÖÇùÖÅùÖÄùÑøùÑæùÑΩùÑºùÑªùÑ∫ùÑπùÑ∏ùÑ∑ùÑ∂ùÑµùÑ¥ùÑ≥ùÑ≤ùÑ±ùÑ∞ùÑØùÑÆùÑ≠ùÑ¨ùÑ´ùÑ™ùÑ©ùÑ¶ùÑ•ùÑ§ùÑ£ùÑ¢ùÑ°ùÑ†ùÑüùÑûùÑùùÑúùÑõùÑöùÑôùÑòùÑóùÑñùÑïùÑîùÑìùÑíùÑëùÑêùÑèùÑéùÑçùÑåùÑãùÑäùÑâùÑàùÑáùÑÜùÑÖùÑÑùÑÉùÑÇùÑÅùÑÄ"



Gsharp
################################################################################

Dictionaire
================================================================================

::


                             syst√®me de port√©es : ensemble de port√©es li√©es par des accolades.

    staff (stave)          = port√©e

    clef                   = clef
    key signature          = armure
    time signature         = chiffrage

    treble clef            = clef de sol
    alto clef (viola clef) = clef d'ut
    tenor clef             = clef d'ut
    bass clef              = clef de fa

    bar                    = mesure


octaviation: 8va = +octave ; 8va bassa = -octave



Files
================================================================================

packages

    definition of the packages.

utilities

    stealth class mixin &c.

mf

    meta-font


sdl

    drawing fonts


score-pane

    drawing partition elements


buffer

    definition of parition structure objects, from buffers down to the notes (elements).


melody

    musical elements in the buffers.


lyrics

    lyric elements in the buffers


numbering

    gives the number of each kind of element.


--

Obseq/obseq

    Object sequences, subdivided in groups by optimization of a cost function.


measure

    measure = set of parallel bars, and obelem.  This file provides
    the cost functions to spread the measures nicely over the lines of
    the partition.


beaming

    Computes position and direction of beams.


elasticity

    Elasticity function (used by drawing).


drawing

    compute and draw the partition


cursor

input-state

modes

play

    Midi play.


clim-utils

gui

undo

fontview


Mxml/sequence
Mxml/mxml
Mxml/commands

    Music XML file format.




Schematic class diagram
================================================================================

::


                                                                       key-signature
                                                                            |
                                    +-----------------------------1 clef    |         time-signature
                                    |                                |      |               |
                                    |                                +------+---------------+
                                    |                                       |
                                    |                                       v
                         fiveline-staff 1--------------------------* staffwise-element
                               |                                            |
                               v                                            |
       +-------------------* staff                                          |
       |                       *                                            |
       |                       |                                            v
    buffer 1--* segment 1--* layer 1--3 slice 1--* bar 1---------------* element
                               |                    |                      ^
                               |                    |                      |
                               |                    |               rhythmic-element
                               |                    |                      ^
                               |                    |                      |
                          melody-layer         melody-bar             melody-element
                                                                           ^
                                                                           |
                                                                           +-----------+
                                                                           |           |
                                                                        cluster       rest
                                                                           |
                                                                           *
                                                                          note
                                                                              
                                                                              
              tuning                                                          
                ^                                                             
                |                                                             
                +---------+                                                   
                |         |                                                   
              12-edo   regular-temperament                                    
                                                                              

Class hierarchy
================================================================================
::

    gsharp-object ()
    name-mixin ()
    rhythmic-element (element)
    buffer (gsharp-object esa-buffer-mixin drei:undo-mixin)
    layer (gsharp-object name-mixin)
    staff (gsharp-object name-mixin)
    bar (gsharp-object)
    element (gsharp-object)
    segment (gsharp-object)
    slice (gsharp-object)

    melody-bar (bar)
    staffwise-element (element)
    note (gsharp-object)
    tuning (gsharp-object)
    melody-layer (layer)
    cluster (melody-element)
    rest (melody-element)
    melody-element (rhythmic-element)
    fiveline-staff (staff)
    clef (staffwise-element gsharp-object name-mixin)
    key-signature (staffwise-element)
    time-signature (staffwise-element)
    12-edo (tuning)
    regular-temperament (tuning)

    lyrics-bar (bar)
    lyrics-layer (layer)
    lyrics-element (rhythmic-element)
    lyrics-staff (staff)

    measure-cost-method (cost-method)
    timeline (flexichain:element-rank-mixin)
    ranked-flexichain (flexichain:standard-flexichain flexichain:flexirank-mixin)
    measure (obseq-elem)
    measure-seq-cost (seq-cost)
    measure-total-cost (total-cost)

    x-y-width-mixin ()


.. comment:

    Questions
    ################################################################################


    A confirmer:

    - pas de 'measures' (set of parallel 'bars').

      (cependant, on peut avoir 1-3 port√©es pour les instruments √† large gamme).


    - 6/100 seconde pour un M, environ 5 mm, √ßa fait (* (/ 180.0 5) 0.06) -> 2.16 seconde par ligne.
      Moins si on rallonge les mesures.


    - fichier midi typique (pas musique m√©tr√©e)?



    - note port√©e (avec un trait horizontal dessus)?





Miscellaneous
################################################################################

Conversion cvs mcclim repository to git
================================================================================

::

    cd src
    flex cvsclone.l && gcc -Wall -O2 lex.yy.c -o cvsclone
    ./cvsclone -d  :pserver:anonymous@common-lisp.net:/project/mcclim/cvsroot mcclim-CVS

    mkdir mcclim-git  ; cd  mcclim-git  ; git init ; echo '\*~' > .gitignore ; git add .gitignore ; git commit -a -m 'Added ".gitignore".'
    git --bare cvsimport -d:local:/home/pjb/works/gsharp/src/mcclim -v -k -m -i -o master .

    https://github.com/$u/mcclim


Finally, we're using a clone of https://github.com/jmorrison/mcclim.git

::
   (ql:quickload :clim-examples)

References
================================================================================

::

    midi standard        http://www.midi.org/techspecs/
    midi status          http://www.midimountain.com/midi/midi_status.htm
    midi control change  http://nickfever.com/402/production-tips-and-resources/midi-cc-list/
    Unicode:             http://www.marathon-studios.com/unicode/categories/So/Other_Symbol
                         http://www.unicode.org/charts/PDF/U1D100.pdf

Warnings
================================================================================


::

    ;Compiler warnings for "home:works;gsharp;src;gsharp;gui.lisp.newest" :
    ;   In (esa-buffer:frame-make-buffer-from-stream (gsharp:gsharp t)) inside an anonymous lambda form: Undefined function gsharp-midi-load:midi-stream-p
    ;   In (esa-buffer:frame-make-buffer-from-stream (gsharp:gsharp t)) inside an anonymous lambda form: Undefined function gsharp-midi-load:read-buffer-from-midi-stream
    ;Compiler warnings for "home:works;gsharp;src;gsharp;drawing.lisp.newest" :
    ;   In gsharp-drawing::final-absolute-dot-xoffset: Undefined function gsharp-measure:final-relative-dot-xoffset
    ;Compiler warnings for "home:works;gsharp;src;gsharp;buffer.lisp.newest" :
    ;   In gsharp-buffer::add-new-selection: Undefined function (setf gsharp-buffer::buffer-back-selection)
    ;   In gsharp-buffer::add-new-selection: Undefined function gsharp-buffer::buffer-back-selection
    ;   In gsharp-buffer::add-new-selection: Undefined function (setf gsharp-buffer::buffer-back-selection)
    ;   In gsharp-buffer::add-new-selection: Undefined function gsharp-buffer::buffer-back-selection
    ;   In gsharp-buffer::add-new-selection: Undefined function gsharp-buffer::buffer-forward-selection
    ;   In gsharp-buffer::selection-browse-forward: Undefined function gsharp-buffer::buffer-forward-selection
    ;   In gsharp-buffer::selection-browse-forward: Undefined function (setf gsharp-buffer::buffer-forward-selection)
    ;   In gsharp-buffer::selection-browse-forward: Undefined function (setf gsharp-buffer::buffer-back-selection)
    ;   In gsharp-buffer::selection-browse-forward: Undefined function gsharp-buffer::buffer-back-selection
    ;   In gsharp-buffer::selection-browse-forward: Undefined function gsharp-buffer::buffer-forward-selection
    ;   In gsharp-buffer::selection-browse-forward: Undefined function gsharp-buffer::buffer-forward-selection
    ;   In gsharp-buffer::selection-browse-backward: Undefined function gsharp-buffer::buffer-back-selection
    ;   In gsharp-buffer::selection-browse-backward: Undefined function (setf gsharp-buffer::buffer-back-selection)
    ;   In gsharp-buffer::selection-browse-backward: Undefined function (setf gsharp-buffer::buffer-forward-selection)
    ;   In gsharp-buffer::selection-browse-backward: Undefined function gsharp-buffer::buffer-forward-selection
    ;   In gsharp-buffer::selection-browse-backward: Undefined function gsharp-buffer::buffer-back-selection
    ;   In gsharp-buffer::selection-browse-backward: Undefined function gsharp-buffer::buffer-back-selection
    ;   In gsharp-buffer::buffer-selection: Undefined function gsharp-buffer::buffer-back-selection
    ;   In gsharp-buffer::buffer-selection: Undefined function gsharp-buffer::buffer-back-selection
    ;Compiler warnings for "home:works;gsharp;src;mcclim;Drei;syntax.lisp.newest" :
    ;   In (drei-syntax:update-lex (drei-syntax:incremental-lexer t t)) inside an anonymous lambda form: Undefined function drei-syntax::low-mark




.. comment:
   ---------------------------------------------------------------
                            -------------
                                  -
                                  .
